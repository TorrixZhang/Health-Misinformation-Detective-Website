{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport FieldContext from './FieldContext';\nimport Field from './Field';\nimport { move as _move, getNamePath } from './utils/valueUtil';\n\nvar List = function List(_ref) {\n  var name = _ref.name,\n      children = _ref.children;\n  var context = React.useContext(FieldContext);\n  var keyRef = React.useRef({\n    keys: [],\n    id: 0\n  });\n  var keyManager = keyRef.current; // User should not pass `children` as other type.\n\n  if (typeof children !== 'function') {\n    warning(false, 'Form.List only accepts function as children.');\n    return null;\n  }\n\n  var parentPrefixName = getNamePath(context.prefixName) || [];\n  var prefixName = [].concat(_toConsumableArray(parentPrefixName), _toConsumableArray(getNamePath(name)));\n\n  var shouldUpdate = function shouldUpdate(prevValue, nextValue, _ref2) {\n    var source = _ref2.source;\n\n    if (source === 'internal') {\n      return false;\n    }\n\n    return prevValue !== nextValue;\n  };\n\n  return React.createElement(FieldContext.Provider, {\n    value: _objectSpread(_objectSpread({}, context), {}, {\n      prefixName: prefixName\n    })\n  }, React.createElement(Field, {\n    name: [],\n    shouldUpdate: shouldUpdate\n  }, function (_ref3) {\n    var _ref3$value = _ref3.value,\n        value = _ref3$value === void 0 ? [] : _ref3$value,\n        onChange = _ref3.onChange;\n    var getFieldValue = context.getFieldValue;\n\n    var getNewValue = function getNewValue() {\n      var values = getFieldValue(prefixName || []);\n      return values || [];\n    };\n    /**\n     * Always get latest value in case user update fields by `form` api.\n     */\n\n\n    var operations = {\n      add: function add(defaultValue, index) {\n        // Mapping keys\n        var newValue = getNewValue();\n\n        if (index >= 0 && index <= newValue.length) {\n          keyManager.keys = [].concat(_toConsumableArray(keyManager.keys.slice(0, index)), [keyManager.id], _toConsumableArray(keyManager.keys.slice(index)));\n          onChange([].concat(_toConsumableArray(newValue.slice(0, index)), [defaultValue], _toConsumableArray(newValue.slice(index))));\n        } else {\n          if (process.env.NODE_ENV !== 'production' && (index < 0 || index > newValue.length)) {\n            warning(false, 'The second parameter of the add function should be a valid positive number.');\n          }\n\n          keyManager.keys = [].concat(_toConsumableArray(keyManager.keys), [keyManager.id]);\n          onChange([].concat(_toConsumableArray(newValue), [defaultValue]));\n        }\n\n        keyManager.id += 1;\n      },\n      remove: function remove(index) {\n        var newValue = getNewValue();\n        var indexSet = new Set(Array.isArray(index) ? index : [index]);\n\n        if (indexSet.size <= 0) {\n          return;\n        }\n\n        keyManager.keys = keyManager.keys.filter(function (_, keysIndex) {\n          return !indexSet.has(keysIndex);\n        }); // Trigger store change\n\n        onChange(newValue.filter(function (_, valueIndex) {\n          return !indexSet.has(valueIndex);\n        }));\n      },\n      move: function move(from, to) {\n        if (from === to) {\n          return;\n        }\n\n        var newValue = getNewValue(); // Do not handle out of range\n\n        if (from < 0 || from >= newValue.length || to < 0 || to >= newValue.length) {\n          return;\n        }\n\n        keyManager.keys = _move(keyManager.keys, from, to); // Trigger store change\n\n        onChange(_move(newValue, from, to));\n      }\n    };\n    var listValue = value || [];\n\n    if (!Array.isArray(listValue)) {\n      listValue = [];\n\n      if (process.env.NODE_ENV !== 'production') {\n        warning(false, \"Current value of '\".concat(prefixName.join(' > '), \"' is not an array type.\"));\n      }\n    }\n\n    return children(listValue.map(function (__, index) {\n      var key = keyManager.keys[index];\n\n      if (key === undefined) {\n        keyManager.keys[index] = keyManager.id;\n        key = keyManager.keys[index];\n        keyManager.id += 1;\n      }\n\n      return {\n        name: index,\n        key: key,\n        isListField: true\n      };\n    }), operations);\n  }));\n};\n\nexport default List;","map":{"version":3,"names":["_objectSpread","_toConsumableArray","React","warning","FieldContext","Field","move","_move","getNamePath","List","_ref","name","children","context","useContext","keyRef","useRef","keys","id","keyManager","current","parentPrefixName","prefixName","concat","shouldUpdate","prevValue","nextValue","_ref2","source","createElement","Provider","value","_ref3","_ref3$value","onChange","getFieldValue","getNewValue","values","operations","add","defaultValue","index","newValue","length","slice","process","env","NODE_ENV","remove","indexSet","Set","Array","isArray","size","filter","_","keysIndex","has","valueIndex","from","to","listValue","join","map","__","key","undefined","isListField"],"sources":["/Users/jiayue/7381-website/node_modules/rc-field-form/es/List.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport FieldContext from './FieldContext';\nimport Field from './Field';\nimport { move as _move, getNamePath } from './utils/valueUtil';\n\nvar List = function List(_ref) {\n  var name = _ref.name,\n      children = _ref.children;\n  var context = React.useContext(FieldContext);\n  var keyRef = React.useRef({\n    keys: [],\n    id: 0\n  });\n  var keyManager = keyRef.current; // User should not pass `children` as other type.\n\n  if (typeof children !== 'function') {\n    warning(false, 'Form.List only accepts function as children.');\n    return null;\n  }\n\n  var parentPrefixName = getNamePath(context.prefixName) || [];\n  var prefixName = [].concat(_toConsumableArray(parentPrefixName), _toConsumableArray(getNamePath(name)));\n\n  var shouldUpdate = function shouldUpdate(prevValue, nextValue, _ref2) {\n    var source = _ref2.source;\n\n    if (source === 'internal') {\n      return false;\n    }\n\n    return prevValue !== nextValue;\n  };\n\n  return React.createElement(FieldContext.Provider, {\n    value: _objectSpread(_objectSpread({}, context), {}, {\n      prefixName: prefixName\n    })\n  }, React.createElement(Field, {\n    name: [],\n    shouldUpdate: shouldUpdate\n  }, function (_ref3) {\n    var _ref3$value = _ref3.value,\n        value = _ref3$value === void 0 ? [] : _ref3$value,\n        onChange = _ref3.onChange;\n    var getFieldValue = context.getFieldValue;\n\n    var getNewValue = function getNewValue() {\n      var values = getFieldValue(prefixName || []);\n      return values || [];\n    };\n    /**\n     * Always get latest value in case user update fields by `form` api.\n     */\n\n\n    var operations = {\n      add: function add(defaultValue, index) {\n        // Mapping keys\n        var newValue = getNewValue();\n\n        if (index >= 0 && index <= newValue.length) {\n          keyManager.keys = [].concat(_toConsumableArray(keyManager.keys.slice(0, index)), [keyManager.id], _toConsumableArray(keyManager.keys.slice(index)));\n          onChange([].concat(_toConsumableArray(newValue.slice(0, index)), [defaultValue], _toConsumableArray(newValue.slice(index))));\n        } else {\n          if (process.env.NODE_ENV !== 'production' && (index < 0 || index > newValue.length)) {\n            warning(false, 'The second parameter of the add function should be a valid positive number.');\n          }\n\n          keyManager.keys = [].concat(_toConsumableArray(keyManager.keys), [keyManager.id]);\n          onChange([].concat(_toConsumableArray(newValue), [defaultValue]));\n        }\n\n        keyManager.id += 1;\n      },\n      remove: function remove(index) {\n        var newValue = getNewValue();\n        var indexSet = new Set(Array.isArray(index) ? index : [index]);\n\n        if (indexSet.size <= 0) {\n          return;\n        }\n\n        keyManager.keys = keyManager.keys.filter(function (_, keysIndex) {\n          return !indexSet.has(keysIndex);\n        }); // Trigger store change\n\n        onChange(newValue.filter(function (_, valueIndex) {\n          return !indexSet.has(valueIndex);\n        }));\n      },\n      move: function move(from, to) {\n        if (from === to) {\n          return;\n        }\n\n        var newValue = getNewValue(); // Do not handle out of range\n\n        if (from < 0 || from >= newValue.length || to < 0 || to >= newValue.length) {\n          return;\n        }\n\n        keyManager.keys = _move(keyManager.keys, from, to); // Trigger store change\n\n        onChange(_move(newValue, from, to));\n      }\n    };\n    var listValue = value || [];\n\n    if (!Array.isArray(listValue)) {\n      listValue = [];\n\n      if (process.env.NODE_ENV !== 'production') {\n        warning(false, \"Current value of '\".concat(prefixName.join(' > '), \"' is not an array type.\"));\n      }\n    }\n\n    return children(listValue.map(function (__, index) {\n      var key = keyManager.keys[index];\n\n      if (key === undefined) {\n        keyManager.keys[index] = keyManager.id;\n        key = keyManager.keys[index];\n        keyManager.id += 1;\n      }\n\n      return {\n        name: index,\n        key: key,\n        isListField: true\n      };\n    }), operations);\n  }));\n};\n\nexport default List;"],"mappings":"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"},"metadata":{},"sourceType":"module"}