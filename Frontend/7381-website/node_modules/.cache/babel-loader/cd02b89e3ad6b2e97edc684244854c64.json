{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { HOOK_MARK } from './FieldContext';\nimport { allPromiseFinish } from './utils/asyncUtil';\nimport NameMap from './utils/NameMap';\nimport { defaultValidateMessages } from './utils/messages';\nimport { cloneByNamePathList, containsNamePath, getNamePath, getValue, setValue, setValues } from './utils/valueUtil';\nexport var FormStore = function FormStore(forceRootUpdate) {\n  var _this = this;\n\n  _classCallCheck(this, FormStore);\n\n  this.formHooked = false;\n  this.subscribable = true;\n  this.store = {};\n  this.fieldEntities = [];\n  this.initialValues = {};\n  this.callbacks = {};\n  this.validateMessages = null;\n  this.preserve = null;\n  this.lastValidatePromise = null;\n\n  this.getForm = function () {\n    return {\n      getFieldValue: _this.getFieldValue,\n      getFieldsValue: _this.getFieldsValue,\n      getFieldError: _this.getFieldError,\n      getFieldsError: _this.getFieldsError,\n      isFieldsTouched: _this.isFieldsTouched,\n      isFieldTouched: _this.isFieldTouched,\n      isFieldValidating: _this.isFieldValidating,\n      isFieldsValidating: _this.isFieldsValidating,\n      resetFields: _this.resetFields,\n      setFields: _this.setFields,\n      setFieldsValue: _this.setFieldsValue,\n      validateFields: _this.validateFields,\n      submit: _this.submit,\n      getInternalHooks: _this.getInternalHooks\n    };\n  }; // ======================== Internal Hooks ========================\n\n\n  this.getInternalHooks = function (key) {\n    if (key === HOOK_MARK) {\n      _this.formHooked = true;\n      return {\n        dispatch: _this.dispatch,\n        registerField: _this.registerField,\n        useSubscribe: _this.useSubscribe,\n        setInitialValues: _this.setInitialValues,\n        setCallbacks: _this.setCallbacks,\n        setValidateMessages: _this.setValidateMessages,\n        getFields: _this.getFields,\n        setPreserve: _this.setPreserve\n      };\n    }\n\n    warning(false, '`getInternalHooks` is internal usage. Should not call directly.');\n    return null;\n  };\n\n  this.useSubscribe = function (subscribable) {\n    _this.subscribable = subscribable;\n  };\n  /**\n   * First time `setInitialValues` should update store with initial value\n   */\n\n\n  this.setInitialValues = function (initialValues, init) {\n    _this.initialValues = initialValues || {};\n\n    if (init) {\n      _this.store = setValues({}, initialValues, _this.store);\n    }\n  };\n\n  this.getInitialValue = function (namePath) {\n    return getValue(_this.initialValues, namePath);\n  };\n\n  this.setCallbacks = function (callbacks) {\n    _this.callbacks = callbacks;\n  };\n\n  this.setValidateMessages = function (validateMessages) {\n    _this.validateMessages = validateMessages;\n  };\n\n  this.setPreserve = function (preserve) {\n    _this.preserve = preserve;\n  }; // ========================== Dev Warning =========================\n\n\n  this.timeoutId = null;\n\n  this.warningUnhooked = function () {\n    if (process.env.NODE_ENV !== 'production' && !_this.timeoutId && typeof window !== 'undefined') {\n      _this.timeoutId = window.setTimeout(function () {\n        _this.timeoutId = null;\n\n        if (!_this.formHooked) {\n          warning(false, 'Instance created by `useForm` is not connected to any Form element. Forget to pass `form` prop?');\n        }\n      });\n    }\n  }; // ============================ Fields ============================\n\n  /**\n   * Get registered field entities.\n   * @param pure Only return field which has a `name`. Default: false\n   */\n\n\n  this.getFieldEntities = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (!pure) {\n      return _this.fieldEntities;\n    }\n\n    return _this.fieldEntities.filter(function (field) {\n      return field.getNamePath().length;\n    });\n  };\n\n  this.getFieldsMap = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var cache = new NameMap();\n\n    _this.getFieldEntities(pure).forEach(function (field) {\n      var namePath = field.getNamePath();\n      cache.set(namePath, field);\n    });\n\n    return cache;\n  };\n\n  this.getFieldEntitiesForNamePathList = function (nameList) {\n    if (!nameList) {\n      return _this.getFieldEntities(true);\n    }\n\n    var cache = _this.getFieldsMap(true);\n\n    return nameList.map(function (name) {\n      var namePath = getNamePath(name);\n      return cache.get(namePath) || {\n        INVALIDATE_NAME_PATH: getNamePath(name)\n      };\n    });\n  };\n\n  this.getFieldsValue = function (nameList, filterFunc) {\n    _this.warningUnhooked();\n\n    if (nameList === true && !filterFunc) {\n      return _this.store;\n    }\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(Array.isArray(nameList) ? nameList : null);\n\n    var filteredNameList = [];\n    fieldEntities.forEach(function (entity) {\n      var namePath = 'INVALIDATE_NAME_PATH' in entity ? entity.INVALIDATE_NAME_PATH : entity.getNamePath();\n\n      if (!filterFunc) {\n        filteredNameList.push(namePath);\n      } else {\n        var meta = 'getMeta' in entity ? entity.getMeta() : null;\n\n        if (filterFunc(meta)) {\n          filteredNameList.push(namePath);\n        }\n      }\n    });\n    return cloneByNamePathList(_this.store, filteredNameList.map(getNamePath));\n  };\n\n  this.getFieldValue = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n    return getValue(_this.store, namePath);\n  };\n\n  this.getFieldsError = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(nameList);\n\n    return fieldEntities.map(function (entity, index) {\n      if (entity && !('INVALIDATE_NAME_PATH' in entity)) {\n        return {\n          name: entity.getNamePath(),\n          errors: entity.getErrors()\n        };\n      }\n\n      return {\n        name: getNamePath(nameList[index]),\n        errors: []\n      };\n    });\n  };\n\n  this.getFieldError = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.errors;\n  };\n\n  this.isFieldsTouched = function () {\n    _this.warningUnhooked();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var arg0 = args[0],\n        arg1 = args[1];\n    var namePathList;\n    var isAllFieldsTouched = false;\n\n    if (args.length === 0) {\n      namePathList = null;\n    } else if (args.length === 1) {\n      if (Array.isArray(arg0)) {\n        namePathList = arg0.map(getNamePath);\n        isAllFieldsTouched = false;\n      } else {\n        namePathList = null;\n        isAllFieldsTouched = arg0;\n      }\n    } else {\n      namePathList = arg0.map(getNamePath);\n      isAllFieldsTouched = arg1;\n    }\n\n    var testTouched = function testTouched(field) {\n      // Not provide `nameList` will check all the fields\n      if (!namePathList) {\n        return field.isFieldTouched();\n      }\n\n      var fieldNamePath = field.getNamePath();\n\n      if (containsNamePath(namePathList, fieldNamePath)) {\n        return field.isFieldTouched();\n      }\n\n      return isAllFieldsTouched;\n    };\n\n    return isAllFieldsTouched ? _this.getFieldEntities(true).every(testTouched) : _this.getFieldEntities(true).some(testTouched);\n  };\n\n  this.isFieldTouched = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsTouched([name]);\n  };\n\n  this.isFieldsValidating = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntities();\n\n    if (!nameList) {\n      return fieldEntities.some(function (testField) {\n        return testField.isFieldValidating();\n      });\n    }\n\n    var namePathList = nameList.map(getNamePath);\n    return fieldEntities.some(function (testField) {\n      var fieldNamePath = testField.getNamePath();\n      return containsNamePath(namePathList, fieldNamePath) && testField.isFieldValidating();\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsValidating([name]);\n  };\n  /**\n   * Reset Field with field `initialValue` prop.\n   * Can pass `entities` or `namePathList` or just nothing.\n   */\n\n\n  this.resetWithFieldInitialValue = function () {\n    var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // Create cache\n\n    var cache = new NameMap();\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    fieldEntities.forEach(function (field) {\n      var initialValue = field.props.initialValue;\n      var namePath = field.getNamePath(); // Record only if has `initialValue`\n\n      if (initialValue !== undefined) {\n        var records = cache.get(namePath) || new Set();\n        records.add({\n          entity: field,\n          value: initialValue\n        });\n        cache.set(namePath, records);\n      }\n    }); // Reset\n\n    var resetWithFields = function resetWithFields(entities) {\n      entities.forEach(function (field) {\n        var initialValue = field.props.initialValue;\n\n        if (initialValue !== undefined) {\n          var namePath = field.getNamePath();\n\n          var formInitialValue = _this.getInitialValue(namePath);\n\n          if (formInitialValue !== undefined) {\n            // Warning if conflict with form initialValues and do not modify value\n            warning(false, \"Form already set 'initialValues' with path '\".concat(namePath.join('.'), \"'. Field can not overwrite it.\"));\n          } else {\n            var records = cache.get(namePath);\n\n            if (records && records.size > 1) {\n              // Warning if multiple field set `initialValue`and do not modify value\n              warning(false, \"Multiple Field with path '\".concat(namePath.join('.'), \"' set 'initialValue'. Can not decide which one to pick.\"));\n            } else if (records) {\n              var originValue = _this.getFieldValue(namePath); // Set `initialValue`\n\n\n              if (!info.skipExist || originValue === undefined) {\n                _this.store = setValue(_this.store, namePath, _toConsumableArray(records)[0].value);\n              }\n            }\n          }\n        }\n      });\n    };\n\n    var requiredFieldEntities;\n\n    if (info.entities) {\n      requiredFieldEntities = info.entities;\n    } else if (info.namePathList) {\n      requiredFieldEntities = [];\n      info.namePathList.forEach(function (namePath) {\n        var records = cache.get(namePath);\n\n        if (records) {\n          var _requiredFieldEntitie;\n\n          (_requiredFieldEntitie = requiredFieldEntities).push.apply(_requiredFieldEntitie, _toConsumableArray(_toConsumableArray(records).map(function (r) {\n            return r.entity;\n          })));\n        }\n      });\n    } else {\n      requiredFieldEntities = fieldEntities;\n    }\n\n    resetWithFields(requiredFieldEntities);\n  };\n\n  this.resetFields = function (nameList) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (!nameList) {\n      _this.store = setValues({}, _this.initialValues);\n\n      _this.resetWithFieldInitialValue();\n\n      _this.notifyObservers(prevStore, null, {\n        type: 'reset'\n      });\n\n      return;\n    } // Reset by `nameList`\n\n\n    var namePathList = nameList.map(getNamePath);\n    namePathList.forEach(function (namePath) {\n      var initialValue = _this.getInitialValue(namePath);\n\n      _this.store = setValue(_this.store, namePath, initialValue);\n    });\n\n    _this.resetWithFieldInitialValue({\n      namePathList: namePathList\n    });\n\n    _this.notifyObservers(prevStore, namePathList, {\n      type: 'reset'\n    });\n  };\n\n  this.setFields = function (fields) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n    fields.forEach(function (fieldData) {\n      var name = fieldData.name,\n          errors = fieldData.errors,\n          data = _objectWithoutProperties(fieldData, [\"name\", \"errors\"]);\n\n      var namePath = getNamePath(name); // Value\n\n      if ('value' in data) {\n        _this.store = setValue(_this.store, namePath, data.value);\n      }\n\n      _this.notifyObservers(prevStore, [namePath], {\n        type: 'setField',\n        data: fieldData\n      });\n    });\n  };\n\n  this.getFields = function () {\n    var entities = _this.getFieldEntities(true);\n\n    var fields = entities.map(function (field) {\n      var namePath = field.getNamePath();\n      var meta = field.getMeta();\n\n      var fieldData = _objectSpread(_objectSpread({}, meta), {}, {\n        name: namePath,\n        value: _this.getFieldValue(namePath)\n      });\n\n      Object.defineProperty(fieldData, 'originRCField', {\n        value: true\n      });\n      return fieldData;\n    });\n    return fields;\n  }; // =========================== Observer ===========================\n\n\n  this.registerField = function (entity) {\n    _this.fieldEntities.push(entity); // Set initial values\n\n\n    if (entity.props.initialValue !== undefined) {\n      var prevStore = _this.store;\n\n      _this.resetWithFieldInitialValue({\n        entities: [entity],\n        skipExist: true\n      });\n\n      _this.notifyObservers(prevStore, [entity.getNamePath()], {\n        type: 'valueUpdate',\n        source: 'internal'\n      });\n    } // un-register field callback\n\n\n    return function (isListField, preserve) {\n      _this.fieldEntities = _this.fieldEntities.filter(function (item) {\n        return item !== entity;\n      }); // Clean up store value if preserve\n\n      var mergedPreserve = preserve !== undefined ? preserve : _this.preserve;\n\n      if (mergedPreserve === false && !isListField) {\n        var namePath = entity.getNamePath();\n\n        if (_this.getFieldValue(namePath) !== undefined) {\n          _this.store = setValue(_this.store, namePath, undefined);\n        }\n      }\n    };\n  };\n\n  this.dispatch = function (action) {\n    switch (action.type) {\n      case 'updateValue':\n        {\n          var namePath = action.namePath,\n              value = action.value;\n\n          _this.updateValue(namePath, value);\n\n          break;\n        }\n\n      case 'validateField':\n        {\n          var _namePath = action.namePath,\n              triggerName = action.triggerName;\n\n          _this.validateFields([_namePath], {\n            triggerName: triggerName\n          });\n\n          break;\n        }\n\n      default: // Currently we don't have other action. Do nothing.\n\n    }\n  };\n\n  this.notifyObservers = function (prevStore, namePathList, info) {\n    if (_this.subscribable) {\n      var mergedInfo = _objectSpread(_objectSpread({}, info), {}, {\n        store: _this.getFieldsValue(true)\n      });\n\n      _this.getFieldEntities().forEach(function (_ref) {\n        var onStoreChange = _ref.onStoreChange;\n        onStoreChange(prevStore, namePathList, mergedInfo);\n      });\n    } else {\n      _this.forceRootUpdate();\n    }\n  };\n\n  this.updateValue = function (name, value) {\n    var namePath = getNamePath(name);\n    var prevStore = _this.store;\n    _this.store = setValue(_this.store, namePath, value);\n\n    _this.notifyObservers(prevStore, [namePath], {\n      type: 'valueUpdate',\n      source: 'internal'\n    }); // Notify dependencies children with parent update\n\n\n    var childrenFields = _this.getDependencyChildrenFields(namePath);\n\n    _this.validateFields(childrenFields);\n\n    _this.notifyObservers(prevStore, childrenFields, {\n      type: 'dependenciesUpdate',\n      relatedFields: [namePath].concat(_toConsumableArray(childrenFields))\n    }); // trigger callback function\n\n\n    var onValuesChange = _this.callbacks.onValuesChange;\n\n    if (onValuesChange) {\n      var changedValues = cloneByNamePathList(_this.store, [namePath]);\n      onValuesChange(changedValues, _this.store);\n    }\n\n    _this.triggerOnFieldsChange([namePath].concat(_toConsumableArray(childrenFields)));\n  }; // Let all child Field get update.\n\n\n  this.setFieldsValue = function (store) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (store) {\n      _this.store = setValues(_this.store, store);\n    }\n\n    _this.notifyObservers(prevStore, null, {\n      type: 'valueUpdate',\n      source: 'external'\n    });\n  };\n\n  this.getDependencyChildrenFields = function (rootNamePath) {\n    var children = new Set();\n    var childrenFields = [];\n    var dependencies2fields = new NameMap();\n    /**\n     * Generate maps\n     * Can use cache to save perf if user report performance issue with this\n     */\n\n    _this.getFieldEntities().forEach(function (field) {\n      var dependencies = field.props.dependencies;\n      (dependencies || []).forEach(function (dependency) {\n        var dependencyNamePath = getNamePath(dependency);\n        dependencies2fields.update(dependencyNamePath, function () {\n          var fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Set();\n          fields.add(field);\n          return fields;\n        });\n      });\n    });\n\n    var fillChildren = function fillChildren(namePath) {\n      var fields = dependencies2fields.get(namePath) || new Set();\n      fields.forEach(function (field) {\n        if (!children.has(field)) {\n          children.add(field);\n          var fieldNamePath = field.getNamePath();\n\n          if (field.isFieldDirty() && fieldNamePath.length) {\n            childrenFields.push(fieldNamePath);\n            fillChildren(fieldNamePath);\n          }\n        }\n      });\n    };\n\n    fillChildren(rootNamePath);\n    return childrenFields;\n  };\n\n  this.triggerOnFieldsChange = function (namePathList, filedErrors) {\n    var onFieldsChange = _this.callbacks.onFieldsChange;\n\n    if (onFieldsChange) {\n      var fields = _this.getFields();\n      /**\n       * Fill errors since `fields` may be replaced by controlled fields\n       */\n\n\n      if (filedErrors) {\n        var cache = new NameMap();\n        filedErrors.forEach(function (_ref2) {\n          var name = _ref2.name,\n              errors = _ref2.errors;\n          cache.set(name, errors);\n        });\n        fields.forEach(function (field) {\n          // eslint-disable-next-line no-param-reassign\n          field.errors = cache.get(field.name) || field.errors;\n        });\n      }\n\n      var changedFields = fields.filter(function (_ref3) {\n        var fieldName = _ref3.name;\n        return containsNamePath(namePathList, fieldName);\n      });\n      onFieldsChange(changedFields, fields);\n    }\n  }; // =========================== Validate ===========================\n\n\n  this.validateFields = function (nameList, options) {\n    _this.warningUnhooked();\n\n    var provideNameList = !!nameList;\n    var namePathList = provideNameList ? nameList.map(getNamePath) : []; // Collect result in promise list\n\n    var promiseList = [];\n\n    _this.getFieldEntities(true).forEach(function (field) {\n      // Add field if not provide `nameList`\n      if (!provideNameList) {\n        namePathList.push(field.getNamePath());\n      } // Skip if without rule\n\n\n      if (!field.props.rules || !field.props.rules.length) {\n        return;\n      }\n\n      var fieldNamePath = field.getNamePath(); // Add field validate rule in to promise list\n\n      if (!provideNameList || containsNamePath(namePathList, fieldNamePath)) {\n        var promise = field.validateRules(_objectSpread({\n          validateMessages: _objectSpread(_objectSpread({}, defaultValidateMessages), _this.validateMessages)\n        }, options)); // Wrap promise with field\n\n        promiseList.push(promise.then(function () {\n          return {\n            name: fieldNamePath,\n            errors: []\n          };\n        }).catch(function (errors) {\n          return Promise.reject({\n            name: fieldNamePath,\n            errors: errors\n          });\n        }));\n      }\n    });\n\n    var summaryPromise = allPromiseFinish(promiseList);\n    _this.lastValidatePromise = summaryPromise; // Notify fields with rule that validate has finished and need update\n\n    summaryPromise.catch(function (results) {\n      return results;\n    }).then(function (results) {\n      var resultNamePathList = results.map(function (_ref4) {\n        var name = _ref4.name;\n        return name;\n      });\n\n      _this.notifyObservers(_this.store, resultNamePathList, {\n        type: 'validateFinish'\n      });\n\n      _this.triggerOnFieldsChange(resultNamePathList, results);\n    });\n    var returnPromise = summaryPromise.then(function () {\n      if (_this.lastValidatePromise === summaryPromise) {\n        return Promise.resolve(_this.getFieldsValue(namePathList));\n      }\n\n      return Promise.reject([]);\n    }).catch(function (results) {\n      var errorList = results.filter(function (result) {\n        return result && result.errors.length;\n      });\n      return Promise.reject({\n        values: _this.getFieldsValue(namePathList),\n        errorFields: errorList,\n        outOfDate: _this.lastValidatePromise !== summaryPromise\n      });\n    }); // Do not throw in console\n\n    returnPromise.catch(function (e) {\n      return e;\n    });\n    return returnPromise;\n  }; // ============================ Submit ============================\n\n\n  this.submit = function () {\n    _this.warningUnhooked();\n\n    _this.validateFields().then(function (values) {\n      var onFinish = _this.callbacks.onFinish;\n\n      if (onFinish) {\n        try {\n          onFinish(values);\n        } catch (err) {\n          // Should print error if user `onFinish` callback failed\n          console.error(err);\n        }\n      }\n    }).catch(function (e) {\n      var onFinishFailed = _this.callbacks.onFinishFailed;\n\n      if (onFinishFailed) {\n        onFinishFailed(e);\n      }\n    });\n  };\n\n  this.forceRootUpdate = forceRootUpdate;\n};\n\nfunction useForm(form) {\n  var formRef = React.useRef();\n\n  var _React$useState = React.useState(),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      forceUpdate = _React$useState2[1];\n\n  if (!formRef.current) {\n    if (form) {\n      formRef.current = form;\n    } else {\n      // Create a new FormStore if not provided\n      var forceReRender = function forceReRender() {\n        forceUpdate({});\n      };\n\n      var formStore = new FormStore(forceReRender);\n      formRef.current = formStore.getForm();\n    }\n  }\n\n  return [formRef.current];\n}\n\nexport default useForm;","map":{"version":3,"names":["_slicedToArray","_objectSpread","_objectWithoutProperties","_toConsumableArray","_classCallCheck","React","warning","HOOK_MARK","allPromiseFinish","NameMap","defaultValidateMessages","cloneByNamePathList","containsNamePath","getNamePath","getValue","setValue","setValues","FormStore","forceRootUpdate","_this","formHooked","subscribable","store","fieldEntities","initialValues","callbacks","validateMessages","preserve","lastValidatePromise","getForm","getFieldValue","getFieldsValue","getFieldError","getFieldsError","isFieldsTouched","isFieldTouched","isFieldValidating","isFieldsValidating","resetFields","setFields","setFieldsValue","validateFields","submit","getInternalHooks","key","dispatch","registerField","useSubscribe","setInitialValues","setCallbacks","setValidateMessages","getFields","setPreserve","init","getInitialValue","namePath","timeoutId","warningUnhooked","process","env","NODE_ENV","window","setTimeout","getFieldEntities","pure","arguments","length","undefined","filter","field","getFieldsMap","cache","forEach","set","getFieldEntitiesForNamePathList","nameList","map","name","get","INVALIDATE_NAME_PATH","filterFunc","Array","isArray","filteredNameList","entity","push","meta","getMeta","index","errors","getErrors","fieldError","_len","args","_key","arg0","arg1","namePathList","isAllFieldsTouched","testTouched","fieldNamePath","every","some","testField","resetWithFieldInitialValue","info","initialValue","props","records","Set","add","value","resetWithFields","entities","formInitialValue","concat","join","size","originValue","skipExist","requiredFieldEntities","_requiredFieldEntitie","apply","r","prevStore","notifyObservers","type","fields","fieldData","data","Object","defineProperty","source","isListField","item","mergedPreserve","action","updateValue","_namePath","triggerName","mergedInfo","_ref","onStoreChange","childrenFields","getDependencyChildrenFields","relatedFields","onValuesChange","changedValues","triggerOnFieldsChange","rootNamePath","children","dependencies2fields","dependencies","dependency","dependencyNamePath","update","fillChildren","has","isFieldDirty","filedErrors","onFieldsChange","_ref2","changedFields","_ref3","fieldName","options","provideNameList","promiseList","rules","promise","validateRules","then","catch","Promise","reject","summaryPromise","results","resultNamePathList","_ref4","returnPromise","resolve","errorList","result","values","errorFields","outOfDate","e","onFinish","err","console","error","onFinishFailed","useForm","form","formRef","useRef","_React$useState","useState","_React$useState2","forceUpdate","current","forceReRender","formStore"],"sources":["/Users/jiayue/7381-website/node_modules/rc-field-form/es/useForm.js"],"sourcesContent":["import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { HOOK_MARK } from './FieldContext';\nimport { allPromiseFinish } from './utils/asyncUtil';\nimport NameMap from './utils/NameMap';\nimport { defaultValidateMessages } from './utils/messages';\nimport { cloneByNamePathList, containsNamePath, getNamePath, getValue, setValue, setValues } from './utils/valueUtil';\nexport var FormStore = function FormStore(forceRootUpdate) {\n  var _this = this;\n\n  _classCallCheck(this, FormStore);\n\n  this.formHooked = false;\n  this.subscribable = true;\n  this.store = {};\n  this.fieldEntities = [];\n  this.initialValues = {};\n  this.callbacks = {};\n  this.validateMessages = null;\n  this.preserve = null;\n  this.lastValidatePromise = null;\n\n  this.getForm = function () {\n    return {\n      getFieldValue: _this.getFieldValue,\n      getFieldsValue: _this.getFieldsValue,\n      getFieldError: _this.getFieldError,\n      getFieldsError: _this.getFieldsError,\n      isFieldsTouched: _this.isFieldsTouched,\n      isFieldTouched: _this.isFieldTouched,\n      isFieldValidating: _this.isFieldValidating,\n      isFieldsValidating: _this.isFieldsValidating,\n      resetFields: _this.resetFields,\n      setFields: _this.setFields,\n      setFieldsValue: _this.setFieldsValue,\n      validateFields: _this.validateFields,\n      submit: _this.submit,\n      getInternalHooks: _this.getInternalHooks\n    };\n  }; // ======================== Internal Hooks ========================\n\n\n  this.getInternalHooks = function (key) {\n    if (key === HOOK_MARK) {\n      _this.formHooked = true;\n      return {\n        dispatch: _this.dispatch,\n        registerField: _this.registerField,\n        useSubscribe: _this.useSubscribe,\n        setInitialValues: _this.setInitialValues,\n        setCallbacks: _this.setCallbacks,\n        setValidateMessages: _this.setValidateMessages,\n        getFields: _this.getFields,\n        setPreserve: _this.setPreserve\n      };\n    }\n\n    warning(false, '`getInternalHooks` is internal usage. Should not call directly.');\n    return null;\n  };\n\n  this.useSubscribe = function (subscribable) {\n    _this.subscribable = subscribable;\n  };\n  /**\n   * First time `setInitialValues` should update store with initial value\n   */\n\n\n  this.setInitialValues = function (initialValues, init) {\n    _this.initialValues = initialValues || {};\n\n    if (init) {\n      _this.store = setValues({}, initialValues, _this.store);\n    }\n  };\n\n  this.getInitialValue = function (namePath) {\n    return getValue(_this.initialValues, namePath);\n  };\n\n  this.setCallbacks = function (callbacks) {\n    _this.callbacks = callbacks;\n  };\n\n  this.setValidateMessages = function (validateMessages) {\n    _this.validateMessages = validateMessages;\n  };\n\n  this.setPreserve = function (preserve) {\n    _this.preserve = preserve;\n  }; // ========================== Dev Warning =========================\n\n\n  this.timeoutId = null;\n\n  this.warningUnhooked = function () {\n    if (process.env.NODE_ENV !== 'production' && !_this.timeoutId && typeof window !== 'undefined') {\n      _this.timeoutId = window.setTimeout(function () {\n        _this.timeoutId = null;\n\n        if (!_this.formHooked) {\n          warning(false, 'Instance created by `useForm` is not connected to any Form element. Forget to pass `form` prop?');\n        }\n      });\n    }\n  }; // ============================ Fields ============================\n\n  /**\n   * Get registered field entities.\n   * @param pure Only return field which has a `name`. Default: false\n   */\n\n\n  this.getFieldEntities = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (!pure) {\n      return _this.fieldEntities;\n    }\n\n    return _this.fieldEntities.filter(function (field) {\n      return field.getNamePath().length;\n    });\n  };\n\n  this.getFieldsMap = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var cache = new NameMap();\n\n    _this.getFieldEntities(pure).forEach(function (field) {\n      var namePath = field.getNamePath();\n      cache.set(namePath, field);\n    });\n\n    return cache;\n  };\n\n  this.getFieldEntitiesForNamePathList = function (nameList) {\n    if (!nameList) {\n      return _this.getFieldEntities(true);\n    }\n\n    var cache = _this.getFieldsMap(true);\n\n    return nameList.map(function (name) {\n      var namePath = getNamePath(name);\n      return cache.get(namePath) || {\n        INVALIDATE_NAME_PATH: getNamePath(name)\n      };\n    });\n  };\n\n  this.getFieldsValue = function (nameList, filterFunc) {\n    _this.warningUnhooked();\n\n    if (nameList === true && !filterFunc) {\n      return _this.store;\n    }\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(Array.isArray(nameList) ? nameList : null);\n\n    var filteredNameList = [];\n    fieldEntities.forEach(function (entity) {\n      var namePath = 'INVALIDATE_NAME_PATH' in entity ? entity.INVALIDATE_NAME_PATH : entity.getNamePath();\n\n      if (!filterFunc) {\n        filteredNameList.push(namePath);\n      } else {\n        var meta = 'getMeta' in entity ? entity.getMeta() : null;\n\n        if (filterFunc(meta)) {\n          filteredNameList.push(namePath);\n        }\n      }\n    });\n    return cloneByNamePathList(_this.store, filteredNameList.map(getNamePath));\n  };\n\n  this.getFieldValue = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n    return getValue(_this.store, namePath);\n  };\n\n  this.getFieldsError = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(nameList);\n\n    return fieldEntities.map(function (entity, index) {\n      if (entity && !('INVALIDATE_NAME_PATH' in entity)) {\n        return {\n          name: entity.getNamePath(),\n          errors: entity.getErrors()\n        };\n      }\n\n      return {\n        name: getNamePath(nameList[index]),\n        errors: []\n      };\n    });\n  };\n\n  this.getFieldError = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.errors;\n  };\n\n  this.isFieldsTouched = function () {\n    _this.warningUnhooked();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var arg0 = args[0],\n        arg1 = args[1];\n    var namePathList;\n    var isAllFieldsTouched = false;\n\n    if (args.length === 0) {\n      namePathList = null;\n    } else if (args.length === 1) {\n      if (Array.isArray(arg0)) {\n        namePathList = arg0.map(getNamePath);\n        isAllFieldsTouched = false;\n      } else {\n        namePathList = null;\n        isAllFieldsTouched = arg0;\n      }\n    } else {\n      namePathList = arg0.map(getNamePath);\n      isAllFieldsTouched = arg1;\n    }\n\n    var testTouched = function testTouched(field) {\n      // Not provide `nameList` will check all the fields\n      if (!namePathList) {\n        return field.isFieldTouched();\n      }\n\n      var fieldNamePath = field.getNamePath();\n\n      if (containsNamePath(namePathList, fieldNamePath)) {\n        return field.isFieldTouched();\n      }\n\n      return isAllFieldsTouched;\n    };\n\n    return isAllFieldsTouched ? _this.getFieldEntities(true).every(testTouched) : _this.getFieldEntities(true).some(testTouched);\n  };\n\n  this.isFieldTouched = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsTouched([name]);\n  };\n\n  this.isFieldsValidating = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntities();\n\n    if (!nameList) {\n      return fieldEntities.some(function (testField) {\n        return testField.isFieldValidating();\n      });\n    }\n\n    var namePathList = nameList.map(getNamePath);\n    return fieldEntities.some(function (testField) {\n      var fieldNamePath = testField.getNamePath();\n      return containsNamePath(namePathList, fieldNamePath) && testField.isFieldValidating();\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsValidating([name]);\n  };\n  /**\n   * Reset Field with field `initialValue` prop.\n   * Can pass `entities` or `namePathList` or just nothing.\n   */\n\n\n  this.resetWithFieldInitialValue = function () {\n    var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // Create cache\n    var cache = new NameMap();\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    fieldEntities.forEach(function (field) {\n      var initialValue = field.props.initialValue;\n      var namePath = field.getNamePath(); // Record only if has `initialValue`\n\n      if (initialValue !== undefined) {\n        var records = cache.get(namePath) || new Set();\n        records.add({\n          entity: field,\n          value: initialValue\n        });\n        cache.set(namePath, records);\n      }\n    }); // Reset\n\n    var resetWithFields = function resetWithFields(entities) {\n      entities.forEach(function (field) {\n        var initialValue = field.props.initialValue;\n\n        if (initialValue !== undefined) {\n          var namePath = field.getNamePath();\n\n          var formInitialValue = _this.getInitialValue(namePath);\n\n          if (formInitialValue !== undefined) {\n            // Warning if conflict with form initialValues and do not modify value\n            warning(false, \"Form already set 'initialValues' with path '\".concat(namePath.join('.'), \"'. Field can not overwrite it.\"));\n          } else {\n            var records = cache.get(namePath);\n\n            if (records && records.size > 1) {\n              // Warning if multiple field set `initialValue`and do not modify value\n              warning(false, \"Multiple Field with path '\".concat(namePath.join('.'), \"' set 'initialValue'. Can not decide which one to pick.\"));\n            } else if (records) {\n              var originValue = _this.getFieldValue(namePath); // Set `initialValue`\n\n\n              if (!info.skipExist || originValue === undefined) {\n                _this.store = setValue(_this.store, namePath, _toConsumableArray(records)[0].value);\n              }\n            }\n          }\n        }\n      });\n    };\n\n    var requiredFieldEntities;\n\n    if (info.entities) {\n      requiredFieldEntities = info.entities;\n    } else if (info.namePathList) {\n      requiredFieldEntities = [];\n      info.namePathList.forEach(function (namePath) {\n        var records = cache.get(namePath);\n\n        if (records) {\n          var _requiredFieldEntitie;\n\n          (_requiredFieldEntitie = requiredFieldEntities).push.apply(_requiredFieldEntitie, _toConsumableArray(_toConsumableArray(records).map(function (r) {\n            return r.entity;\n          })));\n        }\n      });\n    } else {\n      requiredFieldEntities = fieldEntities;\n    }\n\n    resetWithFields(requiredFieldEntities);\n  };\n\n  this.resetFields = function (nameList) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (!nameList) {\n      _this.store = setValues({}, _this.initialValues);\n\n      _this.resetWithFieldInitialValue();\n\n      _this.notifyObservers(prevStore, null, {\n        type: 'reset'\n      });\n\n      return;\n    } // Reset by `nameList`\n\n\n    var namePathList = nameList.map(getNamePath);\n    namePathList.forEach(function (namePath) {\n      var initialValue = _this.getInitialValue(namePath);\n\n      _this.store = setValue(_this.store, namePath, initialValue);\n    });\n\n    _this.resetWithFieldInitialValue({\n      namePathList: namePathList\n    });\n\n    _this.notifyObservers(prevStore, namePathList, {\n      type: 'reset'\n    });\n  };\n\n  this.setFields = function (fields) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n    fields.forEach(function (fieldData) {\n      var name = fieldData.name,\n          errors = fieldData.errors,\n          data = _objectWithoutProperties(fieldData, [\"name\", \"errors\"]);\n\n      var namePath = getNamePath(name); // Value\n\n      if ('value' in data) {\n        _this.store = setValue(_this.store, namePath, data.value);\n      }\n\n      _this.notifyObservers(prevStore, [namePath], {\n        type: 'setField',\n        data: fieldData\n      });\n    });\n  };\n\n  this.getFields = function () {\n    var entities = _this.getFieldEntities(true);\n\n    var fields = entities.map(function (field) {\n      var namePath = field.getNamePath();\n      var meta = field.getMeta();\n\n      var fieldData = _objectSpread(_objectSpread({}, meta), {}, {\n        name: namePath,\n        value: _this.getFieldValue(namePath)\n      });\n\n      Object.defineProperty(fieldData, 'originRCField', {\n        value: true\n      });\n      return fieldData;\n    });\n    return fields;\n  }; // =========================== Observer ===========================\n\n\n  this.registerField = function (entity) {\n    _this.fieldEntities.push(entity); // Set initial values\n\n\n    if (entity.props.initialValue !== undefined) {\n      var prevStore = _this.store;\n\n      _this.resetWithFieldInitialValue({\n        entities: [entity],\n        skipExist: true\n      });\n\n      _this.notifyObservers(prevStore, [entity.getNamePath()], {\n        type: 'valueUpdate',\n        source: 'internal'\n      });\n    } // un-register field callback\n\n\n    return function (isListField, preserve) {\n      _this.fieldEntities = _this.fieldEntities.filter(function (item) {\n        return item !== entity;\n      }); // Clean up store value if preserve\n\n      var mergedPreserve = preserve !== undefined ? preserve : _this.preserve;\n\n      if (mergedPreserve === false && !isListField) {\n        var namePath = entity.getNamePath();\n\n        if (_this.getFieldValue(namePath) !== undefined) {\n          _this.store = setValue(_this.store, namePath, undefined);\n        }\n      }\n    };\n  };\n\n  this.dispatch = function (action) {\n    switch (action.type) {\n      case 'updateValue':\n        {\n          var namePath = action.namePath,\n              value = action.value;\n\n          _this.updateValue(namePath, value);\n\n          break;\n        }\n\n      case 'validateField':\n        {\n          var _namePath = action.namePath,\n              triggerName = action.triggerName;\n\n          _this.validateFields([_namePath], {\n            triggerName: triggerName\n          });\n\n          break;\n        }\n\n      default: // Currently we don't have other action. Do nothing.\n\n    }\n  };\n\n  this.notifyObservers = function (prevStore, namePathList, info) {\n    if (_this.subscribable) {\n      var mergedInfo = _objectSpread(_objectSpread({}, info), {}, {\n        store: _this.getFieldsValue(true)\n      });\n\n      _this.getFieldEntities().forEach(function (_ref) {\n        var onStoreChange = _ref.onStoreChange;\n        onStoreChange(prevStore, namePathList, mergedInfo);\n      });\n    } else {\n      _this.forceRootUpdate();\n    }\n  };\n\n  this.updateValue = function (name, value) {\n    var namePath = getNamePath(name);\n    var prevStore = _this.store;\n    _this.store = setValue(_this.store, namePath, value);\n\n    _this.notifyObservers(prevStore, [namePath], {\n      type: 'valueUpdate',\n      source: 'internal'\n    }); // Notify dependencies children with parent update\n\n\n    var childrenFields = _this.getDependencyChildrenFields(namePath);\n\n    _this.validateFields(childrenFields);\n\n    _this.notifyObservers(prevStore, childrenFields, {\n      type: 'dependenciesUpdate',\n      relatedFields: [namePath].concat(_toConsumableArray(childrenFields))\n    }); // trigger callback function\n\n\n    var onValuesChange = _this.callbacks.onValuesChange;\n\n    if (onValuesChange) {\n      var changedValues = cloneByNamePathList(_this.store, [namePath]);\n      onValuesChange(changedValues, _this.store);\n    }\n\n    _this.triggerOnFieldsChange([namePath].concat(_toConsumableArray(childrenFields)));\n  }; // Let all child Field get update.\n\n\n  this.setFieldsValue = function (store) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (store) {\n      _this.store = setValues(_this.store, store);\n    }\n\n    _this.notifyObservers(prevStore, null, {\n      type: 'valueUpdate',\n      source: 'external'\n    });\n  };\n\n  this.getDependencyChildrenFields = function (rootNamePath) {\n    var children = new Set();\n    var childrenFields = [];\n    var dependencies2fields = new NameMap();\n    /**\n     * Generate maps\n     * Can use cache to save perf if user report performance issue with this\n     */\n\n    _this.getFieldEntities().forEach(function (field) {\n      var dependencies = field.props.dependencies;\n      (dependencies || []).forEach(function (dependency) {\n        var dependencyNamePath = getNamePath(dependency);\n        dependencies2fields.update(dependencyNamePath, function () {\n          var fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Set();\n          fields.add(field);\n          return fields;\n        });\n      });\n    });\n\n    var fillChildren = function fillChildren(namePath) {\n      var fields = dependencies2fields.get(namePath) || new Set();\n      fields.forEach(function (field) {\n        if (!children.has(field)) {\n          children.add(field);\n          var fieldNamePath = field.getNamePath();\n\n          if (field.isFieldDirty() && fieldNamePath.length) {\n            childrenFields.push(fieldNamePath);\n            fillChildren(fieldNamePath);\n          }\n        }\n      });\n    };\n\n    fillChildren(rootNamePath);\n    return childrenFields;\n  };\n\n  this.triggerOnFieldsChange = function (namePathList, filedErrors) {\n    var onFieldsChange = _this.callbacks.onFieldsChange;\n\n    if (onFieldsChange) {\n      var fields = _this.getFields();\n      /**\n       * Fill errors since `fields` may be replaced by controlled fields\n       */\n\n\n      if (filedErrors) {\n        var cache = new NameMap();\n        filedErrors.forEach(function (_ref2) {\n          var name = _ref2.name,\n              errors = _ref2.errors;\n          cache.set(name, errors);\n        });\n        fields.forEach(function (field) {\n          // eslint-disable-next-line no-param-reassign\n          field.errors = cache.get(field.name) || field.errors;\n        });\n      }\n\n      var changedFields = fields.filter(function (_ref3) {\n        var fieldName = _ref3.name;\n        return containsNamePath(namePathList, fieldName);\n      });\n      onFieldsChange(changedFields, fields);\n    }\n  }; // =========================== Validate ===========================\n\n\n  this.validateFields = function (nameList, options) {\n    _this.warningUnhooked();\n\n    var provideNameList = !!nameList;\n    var namePathList = provideNameList ? nameList.map(getNamePath) : []; // Collect result in promise list\n\n    var promiseList = [];\n\n    _this.getFieldEntities(true).forEach(function (field) {\n      // Add field if not provide `nameList`\n      if (!provideNameList) {\n        namePathList.push(field.getNamePath());\n      } // Skip if without rule\n\n\n      if (!field.props.rules || !field.props.rules.length) {\n        return;\n      }\n\n      var fieldNamePath = field.getNamePath(); // Add field validate rule in to promise list\n\n      if (!provideNameList || containsNamePath(namePathList, fieldNamePath)) {\n        var promise = field.validateRules(_objectSpread({\n          validateMessages: _objectSpread(_objectSpread({}, defaultValidateMessages), _this.validateMessages)\n        }, options)); // Wrap promise with field\n\n        promiseList.push(promise.then(function () {\n          return {\n            name: fieldNamePath,\n            errors: []\n          };\n        }).catch(function (errors) {\n          return Promise.reject({\n            name: fieldNamePath,\n            errors: errors\n          });\n        }));\n      }\n    });\n\n    var summaryPromise = allPromiseFinish(promiseList);\n    _this.lastValidatePromise = summaryPromise; // Notify fields with rule that validate has finished and need update\n\n    summaryPromise.catch(function (results) {\n      return results;\n    }).then(function (results) {\n      var resultNamePathList = results.map(function (_ref4) {\n        var name = _ref4.name;\n        return name;\n      });\n\n      _this.notifyObservers(_this.store, resultNamePathList, {\n        type: 'validateFinish'\n      });\n\n      _this.triggerOnFieldsChange(resultNamePathList, results);\n    });\n    var returnPromise = summaryPromise.then(function () {\n      if (_this.lastValidatePromise === summaryPromise) {\n        return Promise.resolve(_this.getFieldsValue(namePathList));\n      }\n\n      return Promise.reject([]);\n    }).catch(function (results) {\n      var errorList = results.filter(function (result) {\n        return result && result.errors.length;\n      });\n      return Promise.reject({\n        values: _this.getFieldsValue(namePathList),\n        errorFields: errorList,\n        outOfDate: _this.lastValidatePromise !== summaryPromise\n      });\n    }); // Do not throw in console\n\n    returnPromise.catch(function (e) {\n      return e;\n    });\n    return returnPromise;\n  }; // ============================ Submit ============================\n\n\n  this.submit = function () {\n    _this.warningUnhooked();\n\n    _this.validateFields().then(function (values) {\n      var onFinish = _this.callbacks.onFinish;\n\n      if (onFinish) {\n        try {\n          onFinish(values);\n        } catch (err) {\n          // Should print error if user `onFinish` callback failed\n          console.error(err);\n        }\n      }\n    }).catch(function (e) {\n      var onFinishFailed = _this.callbacks.onFinishFailed;\n\n      if (onFinishFailed) {\n        onFinishFailed(e);\n      }\n    });\n  };\n\n  this.forceRootUpdate = forceRootUpdate;\n};\n\nfunction useForm(form) {\n  var formRef = React.useRef();\n\n  var _React$useState = React.useState(),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      forceUpdate = _React$useState2[1];\n\n  if (!formRef.current) {\n    if (form) {\n      formRef.current = form;\n    } else {\n      // Create a new FormStore if not provided\n      var forceReRender = function forceReRender() {\n        forceUpdate({});\n      };\n\n      var formStore = new FormStore(forceReRender);\n      formRef.current = formStore.getForm();\n    }\n  }\n\n  return [formRef.current];\n}\n\nexport default useForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}